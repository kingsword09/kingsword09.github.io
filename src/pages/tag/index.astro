---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { withBase } from "../../utils/urls";

const posts = await getCollection("posts");

const counts = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags) {
    counts.set(tag, (counts.get(tag) ?? 0) + 1);
  }
}

const tags = Array.from(counts.entries()).sort((a, b) => a[0].localeCompare(b[0]));
---

<BaseLayout title="Tags">
  <section class="tags">
    <div class="flex-row-between">
      <h1>All tags</h1>
      <a href={withBase("/")}>
        <i class="fa fa-home" aria-hidden="true"></i> Home
      </a>
    </div>

    <ul>
      {tags.map(([tag, count]) => (
        <li>
          <a class="posts" href={withBase(`/tag/${tag}/`)}>
            {tag.replaceAll("-", " ")} ({count})
          </a>
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>

